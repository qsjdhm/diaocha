<!doctype html>
<html lang="">
	<head>
		<title>调研意向单</title>
		<meta charset="utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="description" content="" />
		<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="renderer" content="webkit" />
		<meta http-equiv="Cache-Control" content="no-siteapp" />
		<meta name="format-detection" content="telephone=no" />
		<link rel="stylesheet" href="js/lib/mui/css/mui.min.css" />
		<link rel="stylesheet" href="css/app.css" />
		<style>
            .dyyxd-page {
                height: 100%;
                width: 100%;
                overflow-y: auto;
                overflow-x: hidden;
                background-color: #FFFCFA;
            }

            .dyyxd-page .top-pack img {
                width: 100%;
            }

            .dyyxd-page .mid-pack {
                box-shadow: 0px 0px 12px 0px rgba(0,0,0,0.04);
                border-radius: 17px 17px 0px 0px;
                margin: 0 18px 0 18px;
                padding: 27px 0 0 0;
                position: relative;
                top: -60px;
                z-index: 9;
                background-color: #fff;
                text-align: center;
            }

            .dyyxd-page .mid-pack .title-pack img {
                width: 178px;
                height: 50px;
            }

            .dyyxd-page .pro-list .item-pack {
                padding: 16px 20px;
                display: -webkit-flex;
                display: flex;
                justify-content: space-between;
                align-items: center;
                min-height: 76px;
            }

            .dyyxd-page .pro-list .item-pack .content {
                flex: 1;
                font-size:14px;
                font-weight:500;
                color:rgba(0,0,0,0.8);
                line-height:22px;
                text-align: left;
            }

            .dyyxd-page .pro-list .item-pack .schedule-item-white-check {
                width: 15px;
                height: 15px;
                margin-left: 23px;
            }
            .dyyxd-page .pro-list .item-pack .schedule-item-white-check .check {
                width: 15px;
                height: 15px;
                background-image: url('./i/dyyxd/check.png');
                background-repeat: no-repeat;
                background-size: 100% 100%;
            }
            .dyyxd-page .pro-list .item-pack .schedule-item-white-check .checked {
                width: 15px;
                height: 15px;
                background-image: url('./i/dyyxd/checked.png');
                background-repeat: no-repeat;
                background-size: 100% 100%;
            }

            .stripes {
                background-color: #fbf9f8;
            }


            .dyyxd-page .other-pack {
                padding: 0 20px;
                padding-bottom: 10px;
            }

            .dyyxd-page .other-pack .label {
                height: 60px;
                line-height: 60px;
                font-size:14px;
                font-weight:500;
                color:rgba(0,0,0,0.8);
                text-align: left;
            }

            .dyyxd-page .other-pack input::-webkit-input-placeholder {
                color:rgba(0,0,0,0.2);
                letter-spacing:1px;
            }
            .dyyxd-page .other-pack input {
                border: 0px solid rgba(0,0,0,.2);
                border-bottom: 1px solid rgba(216,216,216,0.4);
                font-size: 12px;
                padding: 0;
            }
            

            .dyyxd-page .dot-pack {
                text-align: right;
                padding: 0 20px;
                padding-bottom: 10px;
            }

            .dyyxd-page .dot-pack img {
                width: 50px;
                height: auto;
            }

            .dyyxd-page .button-pack {
                height:50px;
                background:rgba(230,20,23,1);
                border-radius:25px;
                margin: 0 30px 0 18px;
                position: relative;
                top: -30px;
            }

            .dyyxd-page .button-pack .button {
                height: 100%;
                width: 100%;
                display: -webkit-flex;
                display: flex;
                justify-content: center;
                align-items: center;
                font-size:14px;
                font-weight:bold;
                color:rgba(255,255,255,1);
            }

            .dyyxd-page .button-pack .button span {
                letter-spacing:1px;
            }

            .dyyxd-page .button-pack .button img {
                width: 14px;
                height: 14px;
                margin-left: 4px;
            }

            


		</style>
	</head>
	<body>
		<div id="dyyxd_page" class="dyyxd-page">
            <div class="top-pack">
                <img src="./i/dyyxd/主图@2x.png" />
            </div>
            <div class="mid-pack">
                <div class="title-pack">
                    <img src="./i/dyyxd/编组@2x.png" />
                </div>
                <div class="pro-list"></div>
                <div class="other-pack">
                    <div class="label">其他</div>
                        <input id="other" type="text" placeholder="请输入">
                    </div>
                    <div class="dot-pack">
                        <img src="./i/dyyxd/dian.png" />
                    </div>
                </div>
                
                <div class="button-pack">
                    <div class="button submit">
                        <span>获取调研意向单</span>
                        <img src="./i/dyyxd/导航栏返回.png" />
                    </div>
                </div>
            </div>
            
		</div>


		<!-- 通用类库 -->
		<script src="js/lib/zepto.js"></script>
		<script src="js/lib/zepto.touch.js"></script>
		<script src="js/lib/fastclick.js"></script>
		<script src="js/lib/mui/js/mui.min.js"></script>

		<script>
			$(function () {
				// 首先取消js在客户端的点击事件300毫秒延迟
				FastClick.attach(document.body);

				// 初始化加载更多
				mui.init({
					swipeBack: true //启用右滑关闭功能
                });

                getList()

                // 获取列表
                function getList () {
                    $.ajax({
                        url: "https://groundpushbff.kangyw.com/markettheme/list",
                        type: 'POST',
                        dataType: 'json',
                        contentType: 'application/json',
                        data: JSON.stringify({
                            contentType: 0
                        }),
                        success: function(result) {
                            if (result.code === 'K-000000') {
                                var html = '';
                                for (var i=0,len=result.context.marketThemeVOList.length; i<len; i++) {
                                    if (i%2 == 0) {
                                        html += '<div class="item-pack">';
                                        html += '    <div class="content">'+result.context.marketThemeVOList[i].content+'</div>';
                                        html += '    <div class="schedule-item-white-check">';
                                        html += '        <div id='+result.context.marketThemeVOList[i].id+' value="0" class="check"></div>';
                                        html += '    </div>';
                                        html += '</div>';
                                    } else {
                                        html += '<div class="item-pack stripes">';
                                        html += '    <div class="content">'+result.context.marketThemeVOList[i].content+'</div>';
                                        html += '    <div class="schedule-item-white-check">';
                                        html += '        <div id='+result.context.marketThemeVOList[i].id+' value="0" class="check"></div>';
                                        html += '    </div>';
                                        html += '</div>';
                                    }
                                }
                                $('.pro-list').append(html)
                            } else {
                                mui.alert(result.msg, '平台服务', function() {
                                    console.info('你刚关闭了警告框');
                                });
                            }
                        },
                        error: function() {
                            mui.alert('获取列表出错！', '平台服务', function() {
                                console.info('你刚关闭了警告框');
                            });
                        }
                    });
                }
                
                // 选框点击
                $('.schedule-item-white-check div').live('click', function () {
                    var selectValue = $(this).attr('value');
                    if (selectValue === '0') {
                        $(this).attr('value', '1');
                        $(this).removeClass('check');
                        $(this).addClass('checked');
                    }
                    if (selectValue === '1') {
                        $(this).attr('value', '0');
                        $(this).removeClass('checked');
                        $(this).addClass('check');
                    }
                })

                $('.submit').live('click', function(){
					var checkedLen = $('.schedule-item-white-check .checked').length;
					if (checkedLen == 0) {
						mui.alert('请至少选中一项', '平台服务', function () {});
						return false
					}
					var content = '';
					for (var i=0; i<checkedLen; i++) {
						if (i > 0) {
							content += ';'+$($('.schedule-item-white-check .checked')[i]).parent().prev().html()
						} else {
							content += $($('.schedule-item-white-check .checked')[i]).parent().prev().html()
						}
					}

					var data = {
						"conpanyName":JSON.parse(window.sessionStorage.dyInfo).conpanyName,
						"contractName":JSON.parse(window.sessionStorage.dyInfo).contractName,
						"contractNo":JSON.parse(window.sessionStorage.dyInfo).contractNo,
						"sex":JSON.parse(window.sessionStorage.dyInfo).sex,
						"contentType":JSON.parse(window.sessionStorage.dyInfo).contentType,
						"content":content,
						"remark":stripscript($.trim($('#other').val()))
					}
					console.info(data)

	                window.sessionStorage.setItem('dyInfo', JSON.stringify(data))
	                window.location.href = 'scbg.html?time='+new Date().getTime();
                })


                function stripscript(s) {
					var pattern = new RegExp("[%--`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）——|{}【】‘；：”“'。，、？]")        //格式 RegExp("[在中间定义特殊过滤字符]")
					var rs = "";
					for (var i = 0; i < s.length; i++) {
						rs = rs+s.substr(i, 1).replace(pattern, '');
					}
					return rs;
				}
				function isPoneAvailable (pone) {
					var myreg = /^[1][3,4,5,7,8][0-9]{9}$/;
					if (!myreg.test(pone)) {
						return false;
					} else {
						return true;
					}
				}
			});
		</script>
	</body>
</html>
